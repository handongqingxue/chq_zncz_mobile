{"ast":null,"code":"import _classCallCheck from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u4EBA\\u5458\\u5B9A\\u4F4D\\u7CFB\\u7EDF\\\\chq_position_app\\\\src\\\\pages\\\\testDataTj\\\\index.js\";\nimport { withRouter } from \"react-router-dom\";\nimport React, { Component } from 'react';\nimport \"./index.less\";\nimport $ from \"jquery\";\nimport ReactEcharts from \"echarts-for-react\";\nimport { DatePicker } from 'antd';\nvar RangePicker = DatePicker.RangePicker;\nimport moment from 'moment';\nimport Super from \"../../super\";\n\nvar TestDataTj = /*#__PURE__*/function (_Component) {\n  _inherits(TestDataTj, _Component);\n\n  function TestDataTj() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TestDataTj);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TestDataTj)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      menuId: 17,\n      legendData: [],\n      xAxisData: [],\n      series: [],\n      searchFlag: \"\",\n      日期: 68,\n      月度周: 69,\n      日: 71,\n      月: 72,\n      报警类型: 73,\n      年: 74,\n      数量: 75,\n      日查询常量: \"date\",\n      周查询常量: \"week\",\n      月查询常量: \"month\"\n    };\n\n    _this.request = function () {\n      _this.initListByMenuId(_this.state.日查询常量, false);\n    };\n\n    _this.initListByMenuId = function (flag, reload) {\n      _this.state.searchFlag = flag;\n      var disabledColIds = \"\";\n      if (_this.state.searchFlag == _this.state.日查询常量) disabledColIds = \"\";else if (_this.state.searchFlag == _this.state.周查询常量) disabledColIds = _this.state.日;else if (_this.state.searchFlag == _this.state.月查询常量) disabledColIds = _this.state.日 + \",\" + _this.state.月度周;\n      Super.super({\n        url: \"api2/entity/\".concat(_this.state.menuId, \"/list/tmpl\"),\n        method: 'GET',\n        query: {\n          disabledColIds: disabledColIds,\n          criteria_13: \"2019-05-20~2020-06-20\"\n        }\n      }).then(function (res) {\n        console.log(res);\n\n        if (!reload) {\n          //这里是初始化报警类型，只有在首次加载页面的时候初始化一次就行\n          res.ltmpl.criterias.map(function (item, index) {\n            if (item.id == 6) {\n              _this.initlegendData(item.fieldId);\n            }\n          });\n        }\n\n        _this.initListByQueryKey(res.queryKey);\n      });\n    };\n\n    _this.initListByQueryKey = function (queryKey) {\n      Super.super({\n        url: \"api2/entity/list/\".concat(queryKey, \"/data\"),\n        method: 'GET'\n      }).then(function (res) {\n        console.log(\"===\" + JSON.stringify(res));\n\n        _this.initXAxisData(res);\n      });\n    };\n\n    _this.initlegendData = function (fieldId) {\n      Super.super({\n        url: \"api2/meta/dict/field_options\",\n        method: 'GET',\n        query: {\n          fieldIds: fieldId\n        }\n      }).then(function (res) {\n        console.log(res.optionsMap[fieldId]);\n        var ldMap = [];\n        var series = [];\n        res.optionsMap[fieldId].map(function (item, index) {\n          ldMap.push(item.title);\n          series.push({\n            name: item.title,\n            type: 'bar',\n            data: [],\n            barGap: 0\n          });\n        });\n\n        _this.setState({\n          legendData: ldMap\n        });\n\n        _this.setState({\n          series: series\n        });\n      });\n    };\n\n    _this.initXAxisData = function (res) {\n      var xAxisData = [];\n      res.entities.map(function (item, index) {\n        var cellMap = item.cellMap; //console.log(cellMap);\n\n        if (_this.state.searchFlag == _this.state.日查询常量) xAxisData.push(cellMap[_this.state.日期]);else if (_this.state.searchFlag == _this.state.周查询常量) xAxisData.push(cellMap[_this.state.年] + \"年\" + cellMap[_this.state.月] + \"月\" + cellMap[_this.state.月度周]);else if (_this.state.searchFlag == _this.state.月查询常量) xAxisData.push(cellMap[_this.state.年] + \"年\" + cellMap[_this.state.月] + \"月\");\n\n        _this.state.series.map(function (sItem, sIndex) {\n          if (cellMap[_this.state.报警类型] == sItem.name) {\n            sItem.data.push(cellMap[_this.state.数量]);\n          }\n        });\n      }); //console.log(this.state.series);\n\n      _this.setState({\n        xAxisData: xAxisData\n      });\n    };\n\n    _this.getOption = function () {\n      var option = {\n        tooltip: {\n          //展示数据\n          trigger: 'axis',\n          axisPointer: {\n            // 坐标轴指示器，坐标轴触发有效\n            type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'\n\n          }\n        },\n        legend: {\n          data: _this.state.legendData\n        },\n        xAxis: {\n          //data:['周一','周二','周三','周四','周五','周六','周日']\n          data: _this.state.xAxisData,\n          axisLabel: {\n            interval: 0,\n            rotate: 90\n          }\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: _this.state.series\n        /*\r\n        [\r\n        {\r\n            name:'人员一键紧急报警',\r\n            type:'bar',\r\n            data:[1000,2000,1500,3000,2000,1200,800],\r\n            barGap:0\r\n        },\r\n        {\r\n            name:'车间缺员报警',\r\n            type:'bar',\r\n            data:[1000,2000,1500,3000,2000,1200,800],\r\n            barGap:0\r\n        }\r\n        ]\r\n         */\n\n      };\n      return option;\n    };\n\n    _this.range = function (start, end) {\n      var result = [];\n\n      for (var i = start; i < end; i++) {\n        result.push(i);\n      }\n\n      return result;\n    };\n\n    _this.disabledDate = function (current) {\n      if (!current) {\n        return false;\n      } else {\n        // 前一天后日期不可选\n        return current < moment().subtract(1, \"days\");\n      }\n    };\n\n    _this.disabledRangeTime = function (dates, type) {\n      if (type === 'start') {\n        // 开始日期\n        if (dates && dates.length >= 1) {\n          console.log(dates[0].get('hour'));\n          console.log(moment().get('hour')); // 判断选择时间=当前时间，=就截取分\n\n          if (dates[0].get('hour') === moment().get('hour')) {\n            return {\n              // 传过去的数据是不显示的\n              disabledHours: function disabledHours() {\n                return _this.range(1, moment().get('hour'));\n              },\n              disabledMinutes: function disabledMinutes() {\n                return _this.range(0, moment().get('minute'));\n              },\n              disabledSeconds: function disabledSeconds() {\n                return _this.range(0, moment().get('second'));\n              }\n            };\n          }\n        }\n\n        return {\n          // 传过去的数据是不显示的\n          disabledHours: function disabledHours() {\n            return _this.range(1, moment().get('hour'));\n          }\n        };\n      } else {// 结束日期\n      }\n    };\n\n    _this.goPage = function (value) {\n      _this.props.history.push(\"/\".concat(value));\n    };\n\n    return _this;\n  }\n\n  _createClass(TestDataTj, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      $(\"html\").css(\"background-color\", \"#fff\");\n      this.request();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          日查询常量 = _this$state.日查询常量,\n          周查询常量 = _this$state.周查询常量,\n          月查询常量 = _this$state.月查询常量;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"bjInfoPage_div\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 16\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"top_div\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 13\n        }\n      }, \"\\u62A5\\u8B66\\u7EDF\\u8BA1\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"back_but_div\",\n        onClick: this.goPage.bind(this, 'testHome'),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 13\n        }\n      }, \"<\\u8FD4\\u56DE\"), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        onClick: function onClick(e) {\n          return _this2.initListByMenuId(日查询常量, true);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 17\n        }\n      }, \"\\u65E5\"), /*#__PURE__*/React.createElement(\"button\", {\n        onClick: function onClick(e) {\n          return _this2.initListByMenuId(周查询常量, true);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 17\n        }\n      }, \"\\u5468\"), /*#__PURE__*/React.createElement(\"button\", {\n        onClick: function onClick(e) {\n          return _this2.initListByMenuId(月查询常量, true);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 17\n        }\n      }, \"\\u6708\"), /*#__PURE__*/React.createElement(RangePicker, {\n        disabledDate: this.disabledDate,\n        disabledTime: this.disabledRangeTime,\n        showTime: {\n          hideDisabledOptions: true,\n          defaultValue: [moment('00:00:00', 'HH:mm:ss'), moment('11:59:59', 'HH:mm:ss')]\n        },\n        format: \"YYYY-MM-DD HH:mm:ss\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 17\n        }\n      })), /*#__PURE__*/React.createElement(ReactEcharts, {\n        id: \"echart\",\n        option: this.getOption(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 13\n        }\n      }));\n    }\n  }]);\n\n  return TestDataTj;\n}(Component);\n\nexport default withRouter(TestDataTj);","map":{"version":3,"sources":["E:/我的文件/人员定位系统/chq_position_app/src/pages/testDataTj/index.js"],"names":["withRouter","React","Component","$","ReactEcharts","DatePicker","RangePicker","moment","Super","TestDataTj","state","menuId","legendData","xAxisData","series","searchFlag","日期","月度周","日","月","报警类型","年","数量","日查询常量","周查询常量","月查询常量","request","initListByMenuId","flag","reload","disabledColIds","super","url","method","query","criteria_13","then","res","console","log","ltmpl","criterias","map","item","index","id","initlegendData","fieldId","initListByQueryKey","queryKey","JSON","stringify","initXAxisData","fieldIds","optionsMap","ldMap","push","title","name","type","data","barGap","setState","entities","cellMap","sItem","sIndex","getOption","option","tooltip","trigger","axisPointer","legend","xAxis","axisLabel","interval","rotate","yAxis","range","start","end","result","i","disabledDate","current","subtract","disabledRangeTime","dates","length","get","disabledHours","disabledMinutes","disabledSeconds","goPage","value","props","history","css","bind","e","hideDisabledOptions","defaultValue"],"mappings":";;;;;;AAAA,SAAQA,UAAR,QAAyB,kBAAzB;AACA,OAAOC,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,OAAO,cAAP;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,YAAP,MAAyB,mBAAzB;AACA,SAASC,UAAT,QAA2B,MAA3B;IACQC,W,GAAgBD,U,CAAhBC,W;AACR,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,KAAP,MAAkB,aAAlB;;IAEMC,U;;;;;;;;;;;;;;;UACFC,K,GAAM;AAACC,MAAAA,MAAM,EAAC,EAAR;AAAWC,MAAAA,UAAU,EAAC,EAAtB;AAAyBC,MAAAA,SAAS,EAAC,EAAnC;AAAsCC,MAAAA,MAAM,EAAC,EAA7C;AAAgDC,MAAAA,UAAU,EAAC,EAA3D;AAA8DC,MAAAA,EAAE,EAAC,EAAjE;AAAoEC,MAAAA,GAAG,EAAC,EAAxE;AAA2EC,MAAAA,CAAC,EAAC,EAA7E;AAAgFC,MAAAA,CAAC,EAAC,EAAlF;AAAqFC,MAAAA,IAAI,EAAC,EAA1F;AAA6FC,MAAAA,CAAC,EAAC,EAA/F;AAAkGC,MAAAA,EAAE,EAAC,EAArG;AAAwGC,MAAAA,KAAK,EAAC,MAA9G;AAAqHC,MAAAA,KAAK,EAAC,MAA3H;AAAkIC,MAAAA,KAAK,EAAC;AAAxI,K;;UAMNC,O,GAAQ,YAAI;AACR,YAAKC,gBAAL,CAAsB,MAAKjB,KAAL,CAAWa,KAAjC,EAAuC,KAAvC;AACH,K;;UACDI,gB,GAAiB,UAACC,IAAD,EAAMC,MAAN,EAAe;AAC5B,YAAKnB,KAAL,CAAWK,UAAX,GAAsBa,IAAtB;AACA,UAAIE,cAAc,GAAC,EAAnB;AACA,UAAG,MAAKpB,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWa,KAArC,EACIO,cAAc,GAAC,EAAf,CADJ,KAEK,IAAG,MAAKpB,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWc,KAArC,EACDM,cAAc,GAAC,MAAKpB,KAAL,CAAWQ,CAA1B,CADC,KAEA,IAAG,MAAKR,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWe,KAArC,EACDK,cAAc,GAAC,MAAKpB,KAAL,CAAWQ,CAAX,GAAa,GAAb,GAAiB,MAAKR,KAAL,CAAWO,GAA3C;AACJT,MAAAA,KAAK,CAACuB,KAAN,CAAY;AACRC,QAAAA,GAAG,wBAAgB,MAAKtB,KAAL,CAAWC,MAA3B,eADK;AAERsB,QAAAA,MAAM,EAAC,KAFC;AAGRC,QAAAA,KAAK,EAAC;AAACJ,UAAAA,cAAc,EAACA,cAAhB;AAA+BK,UAAAA,WAAW,EAAC;AAA3C;AAHE,OAAZ,EAIGC,IAJH,CAIQ,UAACC,GAAD,EAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;;AACA,YAAG,CAACR,MAAJ,EAAW;AAAC;AACRQ,UAAAA,GAAG,CAACG,KAAJ,CAAUC,SAAV,CAAoBC,GAApB,CAAwB,UAACC,IAAD,EAAMC,KAAN,EAAc;AAClC,gBAAGD,IAAI,CAACE,EAAL,IAAS,CAAZ,EAAc;AACV,oBAAKC,cAAL,CAAoBH,IAAI,CAACI,OAAzB;AACH;AACJ,WAJD;AAKH;;AACD,cAAKC,kBAAL,CAAwBX,GAAG,CAACY,QAA5B;AACH,OAdD;AAeH,K;;UACDD,kB,GAAmB,UAACC,QAAD,EAAY;AAC3BzC,MAAAA,KAAK,CAACuB,KAAN,CAAY;AACRC,QAAAA,GAAG,6BAAqBiB,QAArB,UADK;AAERhB,QAAAA,MAAM,EAAC;AAFC,OAAZ,EAGGG,IAHH,CAGQ,UAACC,GAAD,EAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAY,QAAMW,IAAI,CAACC,SAAL,CAAed,GAAf,CAAlB;;AACA,cAAKe,aAAL,CAAmBf,GAAnB;AACH,OAND;AAOH,K;;UACDS,c,GAAe,UAACC,OAAD,EAAW;AACtBvC,MAAAA,KAAK,CAACuB,KAAN,CAAY;AACRC,QAAAA,GAAG,gCADK;AAERC,QAAAA,MAAM,EAAC,KAFC;AAGRC,QAAAA,KAAK,EAAE;AAACmB,UAAAA,QAAQ,EAACN;AAAV;AAHC,OAAZ,EAIGX,IAJH,CAIQ,UAACC,GAAD,EAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACiB,UAAJ,CAAeP,OAAf,CAAZ;AACA,YAAIQ,KAAK,GAAC,EAAV;AACA,YAAIzC,MAAM,GAAC,EAAX;AACAuB,QAAAA,GAAG,CAACiB,UAAJ,CAAeP,OAAf,EAAwBL,GAAxB,CAA4B,UAACC,IAAD,EAAMC,KAAN,EAAc;AACtCW,UAAAA,KAAK,CAACC,IAAN,CAAWb,IAAI,CAACc,KAAhB;AACA3C,UAAAA,MAAM,CAAC0C,IAAP,CAAY;AAACE,YAAAA,IAAI,EAACf,IAAI,CAACc,KAAX;AAAiBE,YAAAA,IAAI,EAAC,KAAtB;AAA4BC,YAAAA,IAAI,EAAC,EAAjC;AAAoCC,YAAAA,MAAM,EAAC;AAA3C,WAAZ;AACH,SAHD;;AAIA,cAAKC,QAAL,CAAc;AAAClD,UAAAA,UAAU,EAAC2C;AAAZ,SAAd;;AACA,cAAKO,QAAL,CAAc;AAAChD,UAAAA,MAAM,EAACA;AAAR,SAAd;AACH,OAdD;AAeH,K;;UACDsC,a,GAAc,UAACf,GAAD,EAAO;AACjB,UAAIxB,SAAS,GAAC,EAAd;AACAwB,MAAAA,GAAG,CAAC0B,QAAJ,CAAarB,GAAb,CAAiB,UAACC,IAAD,EAAMC,KAAN,EAAc;AAC3B,YAAIoB,OAAO,GAACrB,IAAI,CAACqB,OAAjB,CAD2B,CAE3B;;AACA,YAAG,MAAKtD,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWa,KAArC,EACIV,SAAS,CAAC2C,IAAV,CAAeQ,OAAO,CAAC,MAAKtD,KAAL,CAAWM,EAAZ,CAAtB,EADJ,KAEK,IAAG,MAAKN,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWc,KAArC,EACDX,SAAS,CAAC2C,IAAV,CAAeQ,OAAO,CAAC,MAAKtD,KAAL,CAAWW,CAAZ,CAAP,GAAsB,GAAtB,GAA0B2C,OAAO,CAAC,MAAKtD,KAAL,CAAWS,CAAZ,CAAjC,GAAgD,GAAhD,GAAoD6C,OAAO,CAAC,MAAKtD,KAAL,CAAWO,GAAZ,CAA1E,EADC,KAEA,IAAG,MAAKP,KAAL,CAAWK,UAAX,IAAuB,MAAKL,KAAL,CAAWe,KAArC,EACDZ,SAAS,CAAC2C,IAAV,CAAeQ,OAAO,CAAC,MAAKtD,KAAL,CAAWW,CAAZ,CAAP,GAAsB,GAAtB,GAA0B2C,OAAO,CAAC,MAAKtD,KAAL,CAAWS,CAAZ,CAAjC,GAAgD,GAA/D;;AACJ,cAAKT,KAAL,CAAWI,MAAX,CAAkB4B,GAAlB,CAAsB,UAACuB,KAAD,EAAOC,MAAP,EAAgB;AAClC,cAAGF,OAAO,CAAC,MAAKtD,KAAL,CAAWU,IAAZ,CAAP,IAA0B6C,KAAK,CAACP,IAAnC,EAAwC;AACpCO,YAAAA,KAAK,CAACL,IAAN,CAAWJ,IAAX,CAAgBQ,OAAO,CAAC,MAAKtD,KAAL,CAAWY,EAAZ,CAAvB;AACH;AACJ,SAJD;AAKH,OAdD,EAFiB,CAiBjB;;AACA,YAAKwC,QAAL,CAAc;AAACjD,QAAAA,SAAS,EAACA;AAAX,OAAd;AACH,K;;UACDsD,S,GAAW,YAAK;AACZ,UAAIC,MAAM,GAAG;AACTC,QAAAA,OAAO,EAAC;AAAI;AACRC,UAAAA,OAAO,EAAC,MADJ;AAEJC,UAAAA,WAAW,EAAE;AAAa;AACtBZ,YAAAA,IAAI,EAAE,QADG,CACa;;AADb;AAFT,SADC;AAOTa,QAAAA,MAAM,EAAC;AACHZ,UAAAA,IAAI,EAAC,MAAKlD,KAAL,CAAWE;AADb,SAPE;AAUT6D,QAAAA,KAAK,EAAC;AACF;AACAb,UAAAA,IAAI,EAAC,MAAKlD,KAAL,CAAWG,SAFd;AAGF6D,UAAAA,SAAS,EAAE;AACPC,YAAAA,QAAQ,EAAC,CADF;AAEPC,YAAAA,MAAM,EAAC;AAFA;AAHT,SAVG;AAkBTC,QAAAA,KAAK,EAAC;AACFlB,UAAAA,IAAI,EAAC;AADH,SAlBG;AAqBT7C,QAAAA,MAAM,EAAC,MAAKJ,KAAL,CAAWI;AACd;;;;;;;;;;;;;;;;;AAtBK,OAAb;AAuCA,aAAOsD,MAAP;AACH,K;;UACDU,K,GAAQ,UAACC,KAAD,EAAQC,GAAR,EAAgB;AACpB,UAAMC,MAAM,GAAG,EAAf;;AACA,WAAK,IAAIC,CAAC,GAAGH,KAAb,EAAoBG,CAAC,GAAGF,GAAxB,EAA6BE,CAAC,EAA9B,EAAkC;AAC9BD,QAAAA,MAAM,CAACzB,IAAP,CAAY0B,CAAZ;AACH;;AACD,aAAOD,MAAP;AACH,K;;UACDE,Y,GAAe,UAACC,OAAD,EAAa;AACxB,UAAG,CAACA,OAAJ,EAAY;AACR,eAAO,KAAP;AACH,OAFD,MAEK;AACD;AACA,eAAOA,OAAO,GAAG7E,MAAM,GAAG8E,QAAT,CAAkB,CAAlB,EAAqB,MAArB,CAAjB;AACH;AACJ,K;;UACDC,iB,GAAoB,UAACC,KAAD,EAAQ5B,IAAR,EAAiB;AACjC,UAAIA,IAAI,KAAK,OAAb,EAAsB;AAAE;AACpB,YAAI4B,KAAK,IAAIA,KAAK,CAACC,MAAN,IAAgB,CAA7B,EAAgC;AAC5BlD,UAAAA,OAAO,CAACC,GAAR,CAAYgD,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAa,MAAb,CAAZ;AACAnD,UAAAA,OAAO,CAACC,GAAR,CAAYhC,MAAM,GAAGkF,GAAT,CAAa,MAAb,CAAZ,EAF4B,CAG5B;;AACA,cAAIF,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,CAAa,MAAb,MAAyBlF,MAAM,GAAGkF,GAAT,CAAa,MAAb,CAA7B,EAAmD;AAC/C,mBAAO;AACH;AACAC,cAAAA,aAAa,EAAE;AAAA,uBAAM,MAAKZ,KAAL,CAAW,CAAX,EAAcvE,MAAM,GAAGkF,GAAT,CAAa,MAAb,CAAd,CAAN;AAAA,eAFZ;AAGHE,cAAAA,eAAe,EAAE;AAAA,uBAAM,MAAKb,KAAL,CAAW,CAAX,EAAcvE,MAAM,GAAGkF,GAAT,CAAa,QAAb,CAAd,CAAN;AAAA,eAHd;AAIHG,cAAAA,eAAe,EAAE;AAAA,uBAAM,MAAKd,KAAL,CAAW,CAAX,EAAcvE,MAAM,GAAGkF,GAAT,CAAa,QAAb,CAAd,CAAN;AAAA;AAJd,aAAP;AAMH;AACJ;;AACD,eAAO;AACH;AACAC,UAAAA,aAAa,EAAE;AAAA,mBAAM,MAAKZ,KAAL,CAAW,CAAX,EAAcvE,MAAM,GAAGkF,GAAT,CAAa,MAAb,CAAd,CAAN;AAAA;AAFZ,SAAP;AAIH,OAlBD,MAkBO,CAAE;AACR;AACJ,K;;UACDI,M,GAAO,UAACC,KAAD,EAAS;AACZ,YAAKC,KAAL,CAAWC,OAAX,CAAmBxC,IAAnB,YAA4BsC,KAA5B;AACH,K;;;;;;;wCA/JmB;AAChB3F,MAAAA,CAAC,CAAC,MAAD,CAAD,CAAU8F,GAAV,CAAc,kBAAd,EAAiC,MAAjC;AACA,WAAKvE,OAAL;AACH;;;6BA8JQ;AAAA;;AAAA,wBACqB,KAAKhB,KAD1B;AAAA,UACEa,KADF,eACEA,KADF;AAAA,UACQC,KADR,eACQA,KADR;AAAA,UACcC,KADd,eACcA,KADd;AAEL,0BAAO;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACH;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADG,eAEH;AAAK,QAAA,SAAS,EAAC,cAAf;AAA8B,QAAA,OAAO,EAAE,KAAKoE,MAAL,CAAYK,IAAZ,CAAiB,IAAjB,EAAsB,UAAtB,CAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAFG,eAGH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI;AAAQ,QAAA,OAAO,EAAE,iBAACC,CAAD;AAAA,iBAAK,MAAI,CAACxE,gBAAL,CAAsBJ,KAAtB,EAA4B,IAA5B,CAAL;AAAA,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,eAEI;AAAQ,QAAA,OAAO,EAAE,iBAAC4E,CAAD;AAAA,iBAAK,MAAI,CAACxE,gBAAL,CAAsBH,KAAtB,EAA4B,IAA5B,CAAL;AAAA,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ,eAGI;AAAQ,QAAA,OAAO,EAAE,iBAAC2E,CAAD;AAAA,iBAAK,MAAI,CAACxE,gBAAL,CAAsBF,KAAtB,EAA4B,IAA5B,CAAL;AAAA,SAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHJ,eAKI,oBAAC,WAAD;AACI,QAAA,YAAY,EAAE,KAAK0D,YADvB;AAEI,QAAA,YAAY,EAAE,KAAKG,iBAFvB;AAGI,QAAA,QAAQ,EAAE;AACNc,UAAAA,mBAAmB,EAAE,IADf;AAENC,UAAAA,YAAY,EAAE,CAAC9F,MAAM,CAAC,UAAD,EAAa,UAAb,CAAP,EAAiCA,MAAM,CAAC,UAAD,EAAsB,UAAtB,CAAvC;AAFR,SAHd;AAOI,QAAA,MAAM,EAAC,qBAPX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QALJ,CAHG,eAkBH,oBAAC,YAAD;AAAc,QAAA,EAAE,EAAC,QAAjB;AAA0B,QAAA,MAAM,EAAE,KAAK4D,SAAL,EAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAlBG,CAAP;AAoBH;;;;EA1LoBjE,S;;AA6LzB,eAAeF,UAAU,CAACS,UAAD,CAAzB","sourcesContent":["import {withRouter} from \"react-router-dom\";\r\nimport React, {Component} from 'react'\r\nimport \"./index.less\";\r\nimport $ from \"jquery\";\r\nimport ReactEcharts from \"echarts-for-react\";\r\nimport { DatePicker } from 'antd';\r\nconst { RangePicker } = DatePicker;\r\nimport moment from 'moment';\r\nimport Super from \"../../super\";\r\n\r\nclass TestDataTj extends Component{\r\n    state={menuId:17,legendData:[],xAxisData:[],series:[],searchFlag:\"\",日期:68,月度周:69,日:71,月:72,报警类型:73,年:74,数量:75,日查询常量:\"date\",周查询常量:\"week\",月查询常量:\"month\"}\r\n\r\n    componentDidMount() {\r\n        $(\"html\").css(\"background-color\",\"#fff\");\r\n        this.request();\r\n    }\r\n    request=()=>{\r\n        this.initListByMenuId(this.state.日查询常量,false);\r\n    }\r\n    initListByMenuId=(flag,reload)=>{\r\n        this.state.searchFlag=flag;\r\n        let disabledColIds=\"\";\r\n        if(this.state.searchFlag==this.state.日查询常量)\r\n            disabledColIds=\"\";\r\n        else if(this.state.searchFlag==this.state.周查询常量)\r\n            disabledColIds=this.state.日;\r\n        else if(this.state.searchFlag==this.state.月查询常量)\r\n            disabledColIds=this.state.日+\",\"+this.state.月度周;\r\n        Super.super({\r\n            url:`api2/entity/${this.state.menuId}/list/tmpl`,\r\n            method:'GET',\r\n            query:{disabledColIds:disabledColIds,criteria_13:\"2019-05-20~2020-06-20\"}\r\n        }).then((res) => {\r\n            console.log(res);\r\n            if(!reload){//这里是初始化报警类型，只有在首次加载页面的时候初始化一次就行\r\n                res.ltmpl.criterias.map((item,index)=>{\r\n                    if(item.id==6){\r\n                        this.initlegendData(item.fieldId);\r\n                    }\r\n                });\r\n            }\r\n            this.initListByQueryKey(res.queryKey);\r\n        })\r\n    }\r\n    initListByQueryKey=(queryKey)=>{\r\n        Super.super({\r\n            url:`api2/entity/list/${queryKey}/data`,\r\n            method:'GET',\r\n        }).then((res) => {\r\n            console.log(\"===\"+JSON.stringify(res));\r\n            this.initXAxisData(res);\r\n        })\r\n    }\r\n    initlegendData=(fieldId)=>{\r\n        Super.super({\r\n            url:`api2/meta/dict/field_options`,\r\n            method:'GET',\r\n            query: {fieldIds:fieldId}\r\n        }).then((res) => {\r\n            console.log(res.optionsMap[fieldId]);\r\n            let ldMap=[];\r\n            let series=[];\r\n            res.optionsMap[fieldId].map((item,index)=>{\r\n                ldMap.push(item.title);\r\n                series.push({name:item.title,type:'bar',data:[],barGap:0});\r\n            });\r\n            this.setState({legendData:ldMap});\r\n            this.setState({series:series});\r\n        })\r\n    }\r\n    initXAxisData=(res)=>{\r\n        let xAxisData=[];\r\n        res.entities.map((item,index)=>{\r\n            let cellMap=item.cellMap;\r\n            //console.log(cellMap);\r\n            if(this.state.searchFlag==this.state.日查询常量)\r\n                xAxisData.push(cellMap[this.state.日期]);\r\n            else if(this.state.searchFlag==this.state.周查询常量)\r\n                xAxisData.push(cellMap[this.state.年]+\"年\"+cellMap[this.state.月]+\"月\"+cellMap[this.state.月度周]);\r\n            else if(this.state.searchFlag==this.state.月查询常量)\r\n                xAxisData.push(cellMap[this.state.年]+\"年\"+cellMap[this.state.月]+\"月\");\r\n            this.state.series.map((sItem,sIndex)=>{\r\n                if(cellMap[this.state.报警类型]==sItem.name){\r\n                    sItem.data.push(cellMap[this.state.数量]);\r\n                }\r\n            });\r\n        });\r\n        //console.log(this.state.series);\r\n        this.setState({xAxisData:xAxisData});\r\n    }\r\n    getOption =()=> {\r\n        let option = {\r\n            tooltip:{   //展示数据\r\n                trigger:'axis',\r\n                axisPointer: {            // 坐标轴指示器，坐标轴触发有效\r\n                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'\r\n                }\r\n            },\r\n            legend:{\r\n                data:this.state.legendData\r\n            },\r\n            xAxis:{\r\n                //data:['周一','周二','周三','周四','周五','周六','周日']\r\n                data:this.state.xAxisData,\r\n                axisLabel: {\r\n                    interval:0,\r\n                    rotate:90\r\n                }\r\n            },\r\n            yAxis:{\r\n                type:'value'\r\n            },\r\n            series:this.state.series\r\n                /*\r\n                [\r\n                {\r\n                    name:'人员一键紧急报警',\r\n                    type:'bar',\r\n                    data:[1000,2000,1500,3000,2000,1200,800],\r\n                    barGap:0\r\n                },\r\n                {\r\n                    name:'车间缺员报警',\r\n                    type:'bar',\r\n                    data:[1000,2000,1500,3000,2000,1200,800],\r\n                    barGap:0\r\n                }\r\n            ]\r\n                 */\r\n        }\r\n        return option;\r\n    }\r\n    range = (start, end) => {\r\n        const result = [];\r\n        for (let i = start; i < end; i++) {\r\n            result.push(i);\r\n        }\r\n        return result;\r\n    };\r\n    disabledDate = (current) => {\r\n        if(!current){\r\n            return false\r\n        }else{\r\n            // 前一天后日期不可选\r\n            return current < moment().subtract(1, \"days\")\r\n        }\r\n    };\r\n    disabledRangeTime = (dates, type) => {\r\n        if (type === 'start') { // 开始日期\r\n            if (dates && dates.length >= 1) {\r\n                console.log(dates[0].get('hour'));\r\n                console.log(moment().get('hour'));\r\n                // 判断选择时间=当前时间，=就截取分\r\n                if (dates[0].get('hour') === moment().get('hour')) {\r\n                    return {\r\n                        // 传过去的数据是不显示的\r\n                        disabledHours: () => this.range(1, moment().get('hour')),\r\n                        disabledMinutes: () => this.range(0, moment().get('minute')),\r\n                        disabledSeconds: () => this.range(0, moment().get('second'))\r\n                    };\r\n                }\r\n            }\r\n            return {\r\n                // 传过去的数据是不显示的\r\n                disabledHours: () => this.range(1, moment().get('hour'))\r\n            };\r\n        } else { // 结束日期\r\n        }\r\n    }\r\n    goPage=(value)=>{\r\n        this.props.history.push(`/${value}`);\r\n    }\r\n\r\n    render() {\r\n        const {日查询常量,周查询常量,月查询常量}=this.state\r\n        return <div className=\"bjInfoPage_div\">\r\n            <div className=\"top_div\">报警统计</div>\r\n            <div className=\"back_but_div\" onClick={this.goPage.bind(this,'testHome')}>&lt;返回</div>\r\n            <div>\r\n                <button onClick={(e)=>this.initListByMenuId(日查询常量,true)}>日</button>\r\n                <button onClick={(e)=>this.initListByMenuId(周查询常量,true)}>周</button>\r\n                <button onClick={(e)=>this.initListByMenuId(月查询常量,true)}>月</button>\r\n\r\n                <RangePicker\r\n                    disabledDate={this.disabledDate}\r\n                    disabledTime={this.disabledRangeTime}\r\n                    showTime={{\r\n                        hideDisabledOptions: true,\r\n                        defaultValue: [moment('00:00:00', 'HH:mm:ss'), moment('11:59:59',          'HH:mm:ss')],\r\n                    }}\r\n                    format=\"YYYY-MM-DD HH:mm:ss\"\r\n                />\r\n            </div>\r\n            <ReactEcharts id=\"echart\" option={this.getOption()}/>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport default withRouter(TestDataTj)"]},"metadata":{},"sourceType":"module"}