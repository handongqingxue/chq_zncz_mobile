{"ast":null,"code":"import \"antd-mobile/es/drawer/style\";\nimport _Drawer from \"antd-mobile/es/drawer\";\nimport \"antd-mobile/es/list/style\";\nimport _List from \"antd-mobile/es/list\";\nimport \"antd-mobile/es/button/style\";\nimport _Button from \"antd-mobile/es/button\";\nimport \"antd-mobile/es/toast/style\";\nimport _Toast from \"antd-mobile/es/toast\";\nimport _classCallCheck from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport \"antd-mobile/es/checkbox/style\";\nimport _Checkbox from \"antd-mobile/es/checkbox\";\nvar _jsxFileName = \"E:\\\\\\u6211\\u7684\\u6587\\u4EF6\\\\\\u667A\\u80FD\\u79F0\\u91CD\\u7CFB\\u7EDF\\\\\\u624B\\u673A\\u7AEF\\u9879\\u76EE\\\\chq_zncz_mobile\\\\src\\\\components\\\\TemplateDrawer\\\\index.js\";\nimport React, { Component } from 'react';\nimport Super from './../../super';\nimport './index.less';\nvar CheckboxItem = _Checkbox.CheckboxItem;\n\nvar TemplateDrawer = /*#__PURE__*/function (_Component) {\n  _inherits(TemplateDrawer, _Component);\n\n  function TemplateDrawer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TemplateDrawer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TemplateDrawer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      checkboxdata: [],\n      fieldWords: \"\",\n      showDrawer: false,\n      templateData: []\n    };\n\n    _this.onOpenChange = function (item) {\n      var menuId = _this.props.menuId;\n      var _this$state = _this.state,\n          fieldWords = _this$state.fieldWords,\n          showDrawer = _this$state.showDrawer;\n      var templateGroupId = item.id;\n      var newfields = [];\n\n      if (item.fields) {\n        //获取字段名称\n        item.fields.forEach(function (item) {\n          newfields.push(item.id);\n        });\n\n        if (!fieldWords) {\n          fieldWords = newfields.join(\",\");\n        }\n\n        if (fieldWords && fieldWords !== newfields.join(\",\")) {\n          fieldWords = newfields.join(\",\");\n        }\n      }\n\n      var excepts;\n      var arr = [];\n\n      if (item.lists && item.lists.length > 0) {\n        //获取排除的code\n        item.lists.forEach(function (item) {\n          arr.push(item.code);\n        });\n        excepts = arr.join(\",\");\n      }\n\n      if (showDrawer) {\n        _this.setState({\n          showDrawer: false\n        });\n      } else {\n        Super.super({\n          url: \"api2/meta/tmpl/\".concat(menuId, \"/stmpl/detailGroup/\").concat(templateGroupId),\n          method: \"GET\"\n        }).then(function (res) {\n          _this.setState({\n            showDrawer: true,\n            templateGroupId: templateGroupId,\n            excepts: excepts,\n            fieldWords: fieldWords,\n            menuId: menuId,\n            checkboxdata: [],\n            fields: res.config.columns,\n            addModal: item\n          });\n        });\n        Super.super({\n          url: \"/api2/entity/\".concat(menuId, \"/entityQuery/detailGroup/\").concat(templateGroupId),\n          method: \"GET\",\n          data: {\n            excepts: excepts\n          }\n        }).then(function (res) {\n          _this.goPage(res.queryKey);\n        });\n      }\n    };\n\n    _this.goPage = function (queryKey, page) {\n      var _this$state2 = _this.state,\n          fields = _this$state2.fields,\n          pageInfo = _this$state2.pageInfo;\n      Super.super({\n        url: \"api2/entity/list/\".concat(queryKey, \"/data\"),\n        method: 'GET',\n        data: {\n          pageNo: pageInfo ? pageInfo.pageNo + page : 1\n        }\n      }).then(function (res) {\n        res.entities.forEach(function (item) {\n          item.lists = [];\n\n          var _loop = function _loop(k) {\n            fields.forEach(function (it, index) {\n              if (it.id.toString() === k) {\n                var lis = {\n                  code: item.code,\n                  value: item.cellMap[k],\n                  title: it.title,\n                  key: item.code + index\n                };\n                item.lists.push(lis);\n              }\n            });\n          };\n\n          for (var k in item.cellMap) {\n            _loop(k);\n          }\n        });\n\n        _this.setState({\n          templateData: res.entities,\n          showDrawer: true,\n          pageInfo: res.pageInfo,\n          queryKey: queryKey\n        });\n      });\n    };\n\n    _this.handleDrawerOk = function () {\n      var _this$state3 = _this.state,\n          checkboxdata = _this$state3.checkboxdata,\n          fieldWords = _this$state3.fieldWords,\n          templateGroupId = _this$state3.templateGroupId,\n          menuId = _this$state3.menuId,\n          addModal = _this$state3.addModal;\n      var codes = checkboxdata.join(\",\");\n      Super.super({\n        url: \"api2/entity/\".concat(menuId, \"/selecteor/selected/data/detailGroup/\").concat(templateGroupId),\n        method: 'GET',\n        data: {\n          codes: codes,\n          dfieldIds: fieldWords\n        }\n      }).then(function (res) {\n        if (res.status === \"suc\") {\n          _this.props.loadTemplate(res.entities, addModal);\n\n          _this.setState({\n            showDrawer: false\n          });\n        } else {\n          _Toast.error(res.status);\n        }\n      });\n    };\n\n    _this.changeCheckbox = function (value) {\n      var checkboxdata = _this.state.checkboxdata;\n\n      if (checkboxdata.length === 0) {\n        checkboxdata.push(value);\n      } else {\n        var flag = -1;\n        checkboxdata.forEach(function (item, index) {\n          if (item === value) {\n            flag = index;\n          }\n        });\n\n        if (flag !== -1) {\n          checkboxdata.splice(flag, 1);\n        } else {\n          checkboxdata.push(value);\n        }\n      }\n\n      _this.setState({\n        checkboxdata: checkboxdata\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(TemplateDrawer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.onRef(this);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state4 = this.state,\n          showDrawer = _this$state4.showDrawer,\n          pageInfo = _this$state4.pageInfo,\n          templateData = _this$state4.templateData,\n          queryKey = _this$state4.queryKey;\n      var totalPage = pageInfo ? pageInfo.virtualEndPageNo : \"\";\n      var sidebar = /*#__PURE__*/React.createElement(\"div\", {\n        className: \"sideBar\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 18\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"drawerBtns\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 29\n        }\n      }, pageInfo ? /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 42\n        }\n      }, \"\\u7B2C\", pageInfo.pageNo, \"\\u9875\") : \"\"), /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 8\n        }\n      }, pageInfo && pageInfo.pageNo !== 1 ? /*#__PURE__*/React.createElement(\"span\", {\n        onClick: function onClick() {\n          return _this2.goPage(queryKey, -1);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 42\n        }\n      }, \"\\u4E0A\\u4E00\\u9875\") : null), /*#__PURE__*/React.createElement(_Button, {\n        type: \"warning\",\n        inline: true,\n        size: \"small\",\n        onClick: this.onOpenChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 29\n        }\n      }, \"\\u53D6\\u6D88\"), /*#__PURE__*/React.createElement(_Button, {\n        type: \"primary\",\n        inline: true,\n        size: \"small\",\n        onClick: this.handleDrawerOk,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 29\n        }\n      }, \"\\u786E\\u5B9A\")), templateData ? templateData.map(function (item) {\n        return /*#__PURE__*/React.createElement(_List, {\n          key: item.code,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 33\n          }\n        }, /*#__PURE__*/React.createElement(CheckboxItem, {\n          onChange: function onChange() {\n            return _this2.changeCheckbox(item.code);\n          },\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 10\n          }\n        }, item.lists.map(function (it) {\n          return /*#__PURE__*/React.createElement(_List.Item.Brief, {\n            inline: true,\n            key: it.key,\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 12\n            }\n          }, it.title, \"\\xA0:\\xA0\", it.value);\n        })));\n      }) : \"\", pageInfo && totalPage >= pageInfo.pageNo + 1 ? /*#__PURE__*/React.createElement(_Button, {\n        onClick: function onClick() {\n          return _this2.goPage(queryKey, +1);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 25\n        }\n      }, \"\\u70B9\\u51FB\\u52A0\\u8F7D\\u4E0B\\u4E00\\u9875\") : /*#__PURE__*/React.createElement(\"p\", {\n        className: \"nomoredata\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 25\n        }\n      }, \"\\u6CA1\\u6709\\u66F4\\u591A\\u4E86\\xB7\\xB7\\xB7\"));\n      return /*#__PURE__*/React.createElement(_Drawer, {\n        className: showDrawer ? \"openDrawer\" : \"shutDraw\",\n        style: {\n          minHeight: document.documentElement.clientHeight - 45\n        },\n        contentStyle: {\n          color: '#A6A6A6',\n          textAlign: 'center',\n          paddingTop: 42\n        },\n        sidebar: sidebar,\n        open: showDrawer,\n        position: \"right\",\n        touch: false,\n        enableDragHandle: true,\n        onOpenChange: this.onOpenChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 4\n        }\n      }, \"\\xA0\");\n    }\n  }]);\n\n  return TemplateDrawer;\n}(Component);\n\nexport { TemplateDrawer as default };","map":{"version":3,"sources":["E:/我的文件/智能称重系统/手机端项目/chq_zncz_mobile/src/components/TemplateDrawer/index.js"],"names":["React","Component","Super","CheckboxItem","TemplateDrawer","state","checkboxdata","fieldWords","showDrawer","templateData","onOpenChange","item","menuId","props","templateGroupId","id","newfields","fields","forEach","push","join","excepts","arr","lists","length","code","setState","super","url","method","then","res","config","columns","addModal","data","goPage","queryKey","page","pageInfo","pageNo","entities","k","it","index","toString","lis","value","cellMap","title","key","handleDrawerOk","codes","dfieldIds","status","loadTemplate","error","changeCheckbox","flag","splice","onRef","totalPage","virtualEndPageNo","sidebar","map","minHeight","document","documentElement","clientHeight","color","textAlign","paddingTop"],"mappings":"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","sourcesContent":["import { Button, Checkbox, Drawer, List, Toast } from 'antd-mobile';\r\nimport React, { Component } from 'react';\r\nimport Super from './../../super';\r\nimport './index.less';\r\nconst CheckboxItem = Checkbox.CheckboxItem;\r\n\r\nexport default class TemplateDrawer extends Component {\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.onRef(this)\r\n\t}\r\n\tstate = {\r\n\t\tcheckboxdata: [],\r\n\t\tfieldWords: \"\",\r\n\t\tshowDrawer: false,\r\n\t\ttemplateData: [],\r\n\t}\r\n\tonOpenChange = (item) => {\r\n\t\tlet {menuId} = this.props\r\n\t\tlet {fieldWords,showDrawer} = this.state\r\n\t\tconst templateGroupId = item.id\r\n\t\tlet newfields = []\r\n\t\tif(item.fields) { //获取字段名称\r\n\t\t\titem.fields.forEach((item) => {\r\n\t\t\t\tnewfields.push(item.id)\r\n\t\t\t})\r\n\t\t\tif(!fieldWords) {\r\n\t\t\t\tfieldWords = newfields.join(\",\")\r\n\t\t\t}\r\n\t\t\tif(fieldWords && fieldWords !== newfields.join(\",\")) {\r\n\t\t\t\tfieldWords = newfields.join(\",\")\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet excepts\r\n\t\tlet arr=[]\r\n\t\tif(item.lists && item.lists.length > 0) { //获取排除的code\r\n\t\t\titem.lists.forEach((item) => {\r\n\t\t\t\tarr.push(item.code)\r\n\t\t\t})\r\n\t\t\texcepts=arr.join(\",\")\r\n\t\t}\r\n\t\tif(showDrawer) {\r\n\t\t\tthis.setState({\r\n\t\t\t\tshowDrawer: false,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tSuper.super({\r\n\t\t\t\turl:`api2/meta/tmpl/${menuId}/stmpl/detailGroup/${templateGroupId}`,\r\n\t\t\t\tmethod:\"GET\",\r\n\t\t\t}).then((res) => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tshowDrawer: true,\r\n\t\t\t\t\ttemplateGroupId,\r\n\t\t\t\t\texcepts,\r\n\t\t\t\t\tfieldWords,\r\n\t\t\t\t\tmenuId,\r\n\t\t\t\t\tcheckboxdata: [],\r\n\t\t\t\t\tfields:res.config.columns,\r\n\t\t\t\t\taddModal:item\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\tSuper.super({\r\n\t\t\t\turl:`/api2/entity/${menuId}/entityQuery/detailGroup/${templateGroupId}`,\r\n\t\t\t\tmethod:\"GET\",\r\n\t\t\t\tdata:{\r\n\t\t\t\t\texcepts,\r\n\t\t\t\t}              \r\n\t\t\t}).then((res)=>{\r\n\t\t\t\tthis.goPage(res.queryKey)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tgoPage = (queryKey,page) => {\r\n\t\tconst {fields,pageInfo}=this.state\r\n\t\tSuper.super({\r\n\t\t\turl: `api2/entity/list/${queryKey}/data`,\r\n\t\t\tmethod:'GET',\r\n\t\t\tdata: {pageNo:pageInfo?pageInfo.pageNo+page:1}\r\n\t\t}).then((res) => {\r\n\t\t\tres.entities.forEach((item)=>{\r\n\t\t\t\titem.lists=[]\r\n\t\t\t\tfor(let k in item.cellMap){\r\n\t\t\t\t\tfields.forEach((it,index)=>{\r\n\t\t\t\t\t\tif(it.id.toString()===k){\r\n\t\t\t\t\t\t\tconst lis={\r\n\t\t\t\t\t\t\t\tcode:item.code,\r\n\t\t\t\t\t\t\t\tvalue:item.cellMap[k],\r\n\t\t\t\t\t\t\t\ttitle:it.title,\r\n\t\t\t\t\t\t\t\tkey:item.code+index\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\titem.lists.push(lis)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.setState({\r\n\t\t\t\ttemplateData: res.entities,\r\n\t\t\t\tshowDrawer: true,\r\n\t\t\t\tpageInfo:res.pageInfo,\r\n\t\t\t\tqueryKey\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\thandleDrawerOk = () => {\r\n\t\tconst {checkboxdata,fieldWords,templateGroupId,menuId,addModal} = this.state\r\n\t\tconst codes = checkboxdata.join(\",\")\r\n\t\tSuper.super({\r\n\t\t\turl: `api2/entity/${menuId}/selecteor/selected/data/detailGroup/${templateGroupId}`,\r\n\t\t\tmethod:'GET',\r\n\t\t\tdata: {\r\n\t\t\t\tcodes,\r\n\t\t\t\tdfieldIds: fieldWords,\r\n\t\t\t}\r\n\t\t}).then((res) => {\r\n\t\t\tif(res.status === \"suc\") {\r\n\t\t\t\tthis.props.loadTemplate(res.entities,addModal)\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tshowDrawer: false,\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tToast.error(res.status)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tchangeCheckbox = (value) => {\r\n\t\tconst {checkboxdata} = this.state\r\n\t\tif(checkboxdata.length === 0) {\r\n\t\t\tcheckboxdata.push(value)\r\n\t\t} else {\r\n\t\t\tlet flag = -1\r\n\t\t\tcheckboxdata.forEach((item, index) => {\r\n\t\t\t\tif(item === value) {\r\n\t\t\t\t\tflag = index\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tif(flag !== -1) {\r\n\t\t\t\tcheckboxdata.splice(flag, 1)\r\n\t\t\t} else {\r\n\t\t\t\tcheckboxdata.push(value)\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.setState({\r\n\t\t\tcheckboxdata,\r\n\t\t})\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tconst {showDrawer,pageInfo,templateData,queryKey} = this.state\r\n\t\tconst totalPage = pageInfo ?pageInfo.virtualEndPageNo: \"\"\r\n\t\tlet sidebar = (<div className=\"sideBar\">\r\n                        <div className=\"drawerBtns\">\r\n                            <p>{pageInfo?<span>第{pageInfo.pageNo}页</span>:\"\"}</p>\r\n\t\t\t\t\t\t\t<p>{pageInfo&&pageInfo.pageNo!==1?<span onClick={()=>this.goPage(queryKey,-1)}>上一页</span>:null}</p>\r\n                            <Button type=\"warning\" inline size=\"small\" onClick={this.onOpenChange}>取消</Button>\r\n                            <Button type=\"primary\" inline size=\"small\" onClick={this.handleDrawerOk}>确定</Button>\r\n                        </div>\r\n                        {\r\n                            templateData?templateData.map(item =>\r\n                                <List key={item.code}>\r\n\t\t\t\t\t\t\t\t\t<CheckboxItem onChange={() => this.changeCheckbox(item.code)}>\r\n\t\t\t\t\t\t\t\t\t\t{item.lists.map(it =>\r\n\t\t\t\t\t\t\t\t\t\t\t<List.Item.Brief inline key={it.key}>{it.title}&nbsp;:&nbsp;{it.value}</List.Item.Brief>                                              \r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</CheckboxItem>\r\n\t\t\t\t\t\t\t\t</List>\r\n                            ):\"\"\r\n                        }\r\n                        {pageInfo&&totalPage>=(pageInfo.pageNo+1)?\r\n                        <Button onClick={()=>this.goPage(queryKey,+1)}>点击加载下一页</Button>:\r\n                        <p className=\"nomoredata\">没有更多了···</p>}\r\n                    </div>)\r\n\t\treturn(\r\n\t\t\t<Drawer\r\n                className={showDrawer?\"openDrawer\":\"shutDraw\"}\r\n                style={{ minHeight: document.documentElement.clientHeight-45 }}\r\n                contentStyle={{ color: '#A6A6A6', textAlign: 'center', paddingTop: 42 }}\r\n                sidebar={sidebar}\r\n                open={showDrawer}\r\n                position=\"right\"\r\n                touch={false}\r\n                enableDragHandle\r\n                onOpenChange={this.onOpenChange}\r\n            >\r\n            &nbsp;\r\n            </Drawer>\r\n\t\t)\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}